# Security

Для обеспечения безопасности и управления аутентификацией и авторизацией наше приложение использует Spring Security
который интегрирован с сервером авторизации Keycloak.


## Keycloak

Keycloak - это сервер авторизации с открытым исходным кодом, который предоставляет функциональность аутентификации и авторизации.
В контексте нашего приложения, Keycloak используется для аутентификации пользователей и управления доступом к защищенным ресурсам.
Он позволяет нам делегировать процесс аутентификации и авторизации на сторону сервера. 

При запросе к закрытому ресурсу, юзера перебрасывает на страницу аутентификации в keycloak. После успешной аутентификации, keycloak выдает 
access token и refresh_token.


### Запуск
Keycloak запускается в docker контейнере вместе с базой данных командой <code>docker-compose -f docker-compose-kc.yml up</code>.
Консоль keycloak [тут](http://localhost:8180). Логин admin пароль admin.
База данных заполняется при запуске приложения двумя юзерами. admin/admin   user/manager


Для того что бы keycloak использовал данные пользователей из нашей базы данных, написан keycloak provider который при сборке образа копируется в контейнер.

Все основные настройки keycloak находятся в realm-export.json, при запуске контейнера файл импортируются в keycloak. При добавлении новых сервисов 

Для получения токена сделать запрос: 

![image](./images/postmanGetToken.jpg)

Скопировать из ответа access_token и вставлять его при запросах к закрытым эндпоинтам.Токен действительный только 5 минут. Декодировать токен можно [тут](https://jwt.io/)

![image](./images/postmanAuthRequest.jpg)


Для получения нового токена, сделать запрос в котором передать refresh_token 

![image](./images/postmanRefreshToken.jpg)
